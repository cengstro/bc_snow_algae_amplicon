---
title: "Cellct analysis"
output: html_notebook
---

```{r}
library(tidyverse)
```

```{r}
path_cellct <- here("data/clean/clean.cellct.csv")
cellct <- read_csv(path_cellct)
path_field <- here("data/clean/field_clean.csv")
field <- read_csv(path_field)
path_alias <- here("data/sample_aliases.csv")
alias <- read_csv(path_alias)
```

Add site metadata
```{r}
p <- cellct %>% 
  left_join(field, by="sample_id") %>% 
  left_join(alias, by="sample_id")
p
```


Plot as a heatmap
```{r, fig.height=12, fig.width=7}

morpho_order <- c("Green cell",
                  "Sanguina 'citrine'",
                  "Sanguina nivaloides",
                  "Sanguina nivaloides 'turret'",
                  "Green cell",
                  "Chlainomonas",
                  "Chloromonas krienitzii",
                  "Chloromonas cf. brevispina",
                  "Chloromonas cf. nivalis",
                  "Chloromonas 'spiny'",
                  "Chloromonas 'oval'",
                  "Chloromonas 'zuke'"
                  )

ggplot(p, aes(y=alias %>% fct_reorder(elev_m), 
              x=morpho_sp)) +
  geom_tile(aes(alpha = percent_of_sample, fill = morpho_sp )) + # color = "white" %>% fct_reorder(morpho_order)
  scale_alpha(range = c(0.1, 1)) +
  ylab("Sample ID") +
  xlab("Cell morphology") +
  labs(fill = "Cell morphology", alpha="Relative abundance") +
  scale_x_discrete(position = "bottom") +
  theme(axis.text.x = element_text(hjust=1,angle=45)) +
  guides(fill=FALSE)
```

